{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\liadg\\\\Downloads\\\\Chat-App-BackGammon-main\\\\Chat-App-BackGammon-main\\\\frontend\\\\src\\\\components\\\\HomePage\\\\HomePage.jsx\",\n    _s = $RefreshSig$();\n\nimport \"./HomePage.css\";\nimport React, { useState, useEffect, useRef } from 'react';\nimport { Redirect, Switch, Route } from \"react-router-dom\";\nimport auth from \"../../services/authService\";\nimport ContactsPanel from \"../ContactsPanel/ContactsPanel\";\nimport ChatArea from \"../ChatArea/ChatArea\";\nimport TopBar from \"../TopBar/TopBar\";\nimport { io } from \"socket.io-client\";\nimport Modal from \"../Modal/Modal\";\nimport Game from \"../gameComponents/Game/Game\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction HomePage(props) {\n  _s();\n\n  const [currentUser, setCurrentUser] = useState(null);\n  const [otherUser, setOtherUser] = useState(null);\n  const [onlineUsers, setOnlineUser] = useState([]);\n  const [newMessageRecieved, setNewMessageRecieved] = useState(null);\n  const [openModalReciever, setOpenModalReciever] = useState(false);\n  const [openModalSender, setOpenModalSender] = useState(false);\n  const [gameSender, setGameSender] = useState(\"\");\n  const [gameRoomName, setGameRoomName] = useState(\"\");\n  const socket = useRef();\n  useEffect(() => {\n    const curUser = auth.getCurrentUser();\n    setCurrentUser(curUser);\n  }, []);\n  useEffect(() => {\n    socket.current = io(\"https://chat-app-backgammon-server.herokuapp.com\");\n    socket.current.on(\"getMessage\", data => {\n      const newMsg = {\n        members: [data.senderId, data.recieverId],\n        senderId: data.senderId,\n        text: data.text,\n        createdAt: Date.now()\n      };\n      setNewMessageRecieved(newMsg);\n    });\n    socket.current.on(\"invitedToGame\", data => {\n      setGameSender(data.senderId);\n      setGameRoomName(data.roomName);\n      setOpenModalReciever(true);\n      localStorage.setItem(\"userColor\", \"black\");\n    });\n    socket.current.on(\"startGame\", roomName => {\n      setOpenModalSender(false);\n      console.log(otherUser);\n      localStorage.setItem(\"roomName\", roomName);\n      props.history.replace(\"/game\");\n    });\n  }, []);\n  useEffect(() => {\n    socket.current.emit(\"addUser\", currentUser === null || currentUser === void 0 ? void 0 : currentUser.id);\n    socket.current.on(\"getUsers\", users => {\n      const userss = users.map(user => {\n        return user.userId;\n      });\n      setOnlineUser(userss);\n    });\n  }, [currentUser]);\n\n  const acceptGame = () => {\n    setOpenModalReciever(false);\n    socket.current.emit(\"playerAcceptedGame\", gameRoomName);\n  };\n\n  const checkForUser = () => {\n    const user = auth.getCurrentUser();\n    if (user) return true;\n  };\n\n  const changeChat = otherUserr => {\n    console.log(otherUserr);\n    setOtherUser(otherUser => {\n      return otherUserr;\n    });\n    props.history.replace(\"/chat\");\n  };\n\n  const sendMessageWithSocket = (recieverId, text) => {\n    socket.current.emit(\"sendMessage\", currentUser.id, recieverId, text);\n  };\n\n  const inviteFriendToGame = (recieverId, senderId) => {\n    localStorage.setItem(\"userColor\", \"white\");\n    console.log(otherUser);\n    socket.current.emit(\"inviteToGame\", recieverId, senderId);\n    setOpenModalSender(true);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [!checkForUser() ? /*#__PURE__*/_jsxDEV(Redirect, {\n      to: \"/login\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 32\n    }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(TopBar, {\n        userName: currentUser === null || currentUser === void 0 ? void 0 : currentUser.name\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"messanger\",\n        children: [/*#__PURE__*/_jsxDEV(Switch, {\n          children: [/*#__PURE__*/_jsxDEV(Route, {\n            path: \"/chat\",\n            render: props => {\n              return /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"contactsPanel\",\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"contactsPanelWrapper\",\n                  children: /*#__PURE__*/_jsxDEV(ContactsPanel, {\n                    currentUser: currentUser,\n                    userClick: changeChat,\n                    onlineUsers: onlineUsers\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 105,\n                    columnNumber: 75\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 105,\n                  columnNumber: 37\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 104,\n                columnNumber: 40\n              }, this);\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 103,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            path: \"/game\",\n            render: props => {\n              return /*#__PURE__*/_jsxDEV(ChatArea, {\n                handleSocketMessage: sendMessageWithSocket,\n                friend: otherUser,\n                inviteFriendToGame: inviteFriendToGame,\n                newMessageRecieved: newMessageRecieved,\n                ...props\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 111,\n                columnNumber: 40\n              }, this);\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 110,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            path: \"/\",\n            render: props => {\n              return /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"contactsPanel\",\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"contactsPanelWrapper\",\n                  children: /*#__PURE__*/_jsxDEV(ContactsPanel, {\n                    currentUser: currentUser,\n                    userClick: changeChat,\n                    onlineUsers: onlineUsers\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 119,\n                    columnNumber: 75\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 119,\n                  columnNumber: 37\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 118,\n                columnNumber: 40\n              }, this);\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 117,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chatArea\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chatAreaWrapper\",\n            children: /*#__PURE__*/_jsxDEV(Switch, {\n              children: [/*#__PURE__*/_jsxDEV(Route, {\n                path: \"/chat\",\n                render: props => {\n                  return /*#__PURE__*/_jsxDEV(ChatArea, {\n                    handleSocketMessage: sendMessageWithSocket,\n                    friend: otherUser,\n                    inviteFriendToGame: inviteFriendToGame,\n                    newMessageRecieved: newMessageRecieved,\n                    ...props\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 130,\n                    columnNumber: 48\n                  }, this);\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 129,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(Route, {\n                path: \"/game\",\n                render: props => {\n                  return /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"gameArea\",\n                    children: /*#__PURE__*/_jsxDEV(\"div\", {\n                      children: /*#__PURE__*/_jsxDEV(Game, { ...props\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 140,\n                        columnNumber: 49\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 139,\n                      columnNumber: 45\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 138,\n                    columnNumber: 48\n                  }, this);\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 137,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 128,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 127,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 126,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(Modal, {\n      text: /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            marginBottom: \"20px\"\n          },\n          children: \"waiting for your friend...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 153,\n          columnNumber: 31\n        }, this), /*#__PURE__*/_jsxDEV(\"i\", {\n          class: \"fas fa-circle-notch fa-spin\",\n          children: \" \"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 153,\n          columnNumber: 101\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 26\n      }, this),\n      open: openModalSender\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Modal, {\n      text: `${gameSender} invited you to a game`,\n      open: openModalReciever,\n      acceptMethod: acceptGame,\n      rejectMethod: () => console.log(\"reject\")\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 96,\n    columnNumber: 9\n  }, this);\n}\n\n_s(HomePage, \"9yvYsHeneSWEYeIpMmpUdNYi52g=\");\n\n_c = HomePage;\nexport default HomePage;\n\nvar _c;\n\n$RefreshReg$(_c, \"HomePage\");","map":{"version":3,"sources":["C:/Users/liadg/Downloads/Chat-App-BackGammon-main/Chat-App-BackGammon-main/frontend/src/components/HomePage/HomePage.jsx"],"names":["React","useState","useEffect","useRef","Redirect","Switch","Route","auth","ContactsPanel","ChatArea","TopBar","io","Modal","Game","HomePage","props","currentUser","setCurrentUser","otherUser","setOtherUser","onlineUsers","setOnlineUser","newMessageRecieved","setNewMessageRecieved","openModalReciever","setOpenModalReciever","openModalSender","setOpenModalSender","gameSender","setGameSender","gameRoomName","setGameRoomName","socket","curUser","getCurrentUser","current","on","data","newMsg","members","senderId","recieverId","text","createdAt","Date","now","roomName","localStorage","setItem","console","log","history","replace","emit","id","users","userss","map","user","userId","acceptGame","checkForUser","changeChat","otherUserr","sendMessageWithSocket","inviteFriendToGame","name","marginBottom"],"mappings":"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","sourcesContent":["import \"./HomePage.css\";\r\nimport React, { useState, useEffect, useRef } from 'react'\r\nimport { Redirect, Switch, Route } from \"react-router-dom\";\r\nimport auth from \"../../services/authService\";\r\nimport ContactsPanel from \"../ContactsPanel/ContactsPanel\";\r\nimport ChatArea from \"../ChatArea/ChatArea\";\r\nimport TopBar from \"../TopBar/TopBar\";\r\nimport { io } from \"socket.io-client\";\r\nimport Modal from \"../Modal/Modal\";\r\nimport Game from \"../gameComponents/Game/Game\";\r\n\r\n\r\nfunction HomePage(props) {\r\n    const [currentUser, setCurrentUser] = useState(null);\r\n    const [otherUser, setOtherUser] = useState(null);\r\n    const [onlineUsers, setOnlineUser] = useState([]);\r\n    const [newMessageRecieved, setNewMessageRecieved] = useState(null);\r\n    const [openModalReciever, setOpenModalReciever] = useState(false);\r\n    const [openModalSender, setOpenModalSender] = useState(false);\r\n    const [gameSender, setGameSender] = useState(\"\");\r\n    const [gameRoomName, setGameRoomName] = useState(\"\");\r\n\r\n\r\n    const socket = useRef();\r\n\r\n    useEffect(() => {\r\n        const curUser = auth.getCurrentUser();\r\n        setCurrentUser(curUser);\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n        socket.current = io(\"https://chat-app-backgammon-server.herokuapp.com\");\r\n        socket.current.on(\"getMessage\", (data) => {\r\n            const newMsg = {\r\n                members: [data.senderId, data.recieverId],\r\n                senderId: data.senderId,\r\n                text: data.text,\r\n                createdAt: Date.now()\r\n            }\r\n            setNewMessageRecieved(newMsg);\r\n\r\n        })\r\n        socket.current.on(\"invitedToGame\", (data) => {\r\n            setGameSender(data.senderId);\r\n            setGameRoomName(data.roomName);\r\n            setOpenModalReciever(true);\r\n            localStorage.setItem(\"userColor\", \"black\");\r\n        })\r\n        socket.current.on(\"startGame\", (roomName) => {\r\n            setOpenModalSender(false);\r\n            console.log(otherUser);\r\n            localStorage.setItem(\"roomName\", roomName);\r\n            props.history.replace(\"/game\");\r\n        })\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n        socket.current.emit(\"addUser\", currentUser?.id);\r\n        socket.current.on(\"getUsers\", users => {\r\n            const userss =\r\n                users.map((user) => {\r\n                    return user.userId;\r\n                });\r\n            setOnlineUser(userss);\r\n        });\r\n    }, [currentUser])\r\n\r\n    const acceptGame = () => {\r\n        setOpenModalReciever(false);\r\n        socket.current.emit(\"playerAcceptedGame\", gameRoomName);\r\n    }\r\n\r\n\r\n    const checkForUser = () => {\r\n        const user = auth.getCurrentUser();\r\n        if (user) return true;\r\n    }\r\n    const changeChat = (otherUserr) => {\r\n        console.log(otherUserr)\r\n        setOtherUser(otherUser => { return otherUserr });\r\n        props.history.replace(\"/chat\");\r\n    }\r\n\r\n    const sendMessageWithSocket = (recieverId, text) => {\r\n        socket.current.emit(\"sendMessage\", currentUser.id, recieverId, text);\r\n    }\r\n\r\n    const inviteFriendToGame = (recieverId, senderId) => {\r\n        localStorage.setItem(\"userColor\", \"white\");\r\n        console.log(otherUser)\r\n        socket.current.emit(\"inviteToGame\", recieverId, senderId);\r\n        setOpenModalSender(true);\r\n    }\r\n\r\n    return (\r\n        <div>\r\n            {!checkForUser() ? <Redirect to=\"/login\" /> :\r\n                <div>\r\n                    <TopBar userName={currentUser?.name} />\r\n\r\n                    <div className=\"messanger\">\r\n                        <Switch>\r\n                            <Route path=\"/chat\" render={(props) => {\r\n                                return <div className=\"contactsPanel\">\r\n                                    <div className=\"contactsPanelWrapper\"><ContactsPanel\r\n                                        currentUser={currentUser} userClick={changeChat}\r\n                                        onlineUsers={onlineUsers} /></div>\r\n                                </div>\r\n                            }} />\r\n                            <Route path=\"/game\" render={(props) => {\r\n                                return <ChatArea\r\n                                    handleSocketMessage={sendMessageWithSocket} friend={otherUser}\r\n                                    inviteFriendToGame={inviteFriendToGame}\r\n                                    newMessageRecieved={newMessageRecieved}\r\n                                    {...props} />\r\n                            }} />\r\n                            <Route path=\"/\" render={(props) => {\r\n                                return <div className=\"contactsPanel\">\r\n                                    <div className=\"contactsPanelWrapper\"><ContactsPanel\r\n                                        currentUser={currentUser} userClick={changeChat}\r\n                                        onlineUsers={onlineUsers} /></div>\r\n                                </div>\r\n                            }} />\r\n                        </Switch>\r\n\r\n                        <div className=\"chatArea\">\r\n                            <div className=\"chatAreaWrapper\">\r\n                                <Switch>\r\n                                    <Route path=\"/chat\" render={(props) => {\r\n                                        return <ChatArea\r\n                                            handleSocketMessage={sendMessageWithSocket} friend={otherUser}\r\n                                            inviteFriendToGame={inviteFriendToGame}\r\n                                            newMessageRecieved={newMessageRecieved}\r\n                                            {...props} />\r\n\r\n                                    }} />\r\n                                    <Route path=\"/game\" render={(props) => {\r\n                                        return <div className=\"gameArea\">\r\n                                            <div >\r\n                                                <Game {...props} />\r\n                                            </div>\r\n\r\n                                        </div>\r\n                                    }} />\r\n                                </Switch>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n\r\n                </div>\r\n            }\r\n            <Modal text={<div><div style={{ marginBottom: \"20px\" }}>waiting for your friend...</div><i class=\"fas fa-circle-notch fa-spin\"> </i></div>} open={openModalSender} />\r\n            <Modal text={`${gameSender} invited you to a game`} open={openModalReciever} acceptMethod={acceptGame}\r\n                rejectMethod={() => console.log(\"reject\")} />\r\n\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default HomePage\r\n"]},"metadata":{},"sourceType":"module"}